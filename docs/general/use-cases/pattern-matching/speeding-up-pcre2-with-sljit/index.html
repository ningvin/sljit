<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-general/use-cases/pattern-matching/speeding-up-pcre2-with-sljit" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Speeding Up PCRE2 With SLJIT | SLJIT</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://zherczeg.github.com/sljit/docs/general/use-cases/pattern-matching/speeding-up-pcre2-with-sljit"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Speeding Up PCRE2 With SLJIT | SLJIT"><meta data-rh="true" name="description" content="Adding JIT compilation via SLJIT to the PCRE2 library."><meta data-rh="true" property="og:description" content="Adding JIT compilation via SLJIT to the PCRE2 library."><link data-rh="true" rel="canonical" href="https://zherczeg.github.com/sljit/docs/general/use-cases/pattern-matching/speeding-up-pcre2-with-sljit"><link data-rh="true" rel="alternate" href="https://zherczeg.github.com/sljit/docs/general/use-cases/pattern-matching/speeding-up-pcre2-with-sljit" hreflang="en"><link data-rh="true" rel="alternate" href="https://zherczeg.github.com/sljit/docs/general/use-cases/pattern-matching/speeding-up-pcre2-with-sljit" hreflang="x-default"><link rel="stylesheet" href="/sljit/assets/css/styles.d47d9584.css">
<script src="/sljit/assets/js/runtime~main.c304afc2.js" defer="defer"></script>
<script src="/sljit/assets/js/main.59db08b5.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/sljit/"><b class="navbar__title text--truncate">SLJIT</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/sljit/docs/general/introduction">Docs</a><a class="navbar__item navbar__link" href="/sljit/docs/tutorial/overview">Tutorial</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/zherczeg/sljit" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar--github-link" aria-label="GitHub"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/sljit/docs/general/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/sljit/docs/category/getting-started">Getting Started</a><button aria-label="Expand sidebar category &#x27;Getting Started&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/sljit/docs/general/architecture">Architecture</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/sljit/docs/category/use-cases">Use Cases</a><button aria-label="Collapse sidebar category &#x27;Use Cases&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sljit/docs/general/use-cases/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sljit/docs/general/use-cases/bytecode-interpreters">Bytecode Interpreters</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/sljit/docs/category/pattern-matching">Pattern Matching</a><button aria-label="Collapse sidebar category &#x27;Pattern Matching&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/sljit/docs/general/use-cases/pattern-matching/speeding-up-pcre2-with-sljit">Speeding Up PCRE2 With SLJIT</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/sljit/docs/general/use-cases/pattern-matching/regular-expression-engine-types">Regular Expression Engine Types</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/sljit/docs/general/use-cases/pattern-matching/performance-comparison">Performance Comparison</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/sljit/docs/general/contributing">Contributing</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/sljit/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/sljit/docs/category/use-cases"><span itemprop="name">Use Cases</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/sljit/docs/category/pattern-matching"><span itemprop="name">Pattern Matching</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Speeding Up PCRE2 With SLJIT</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Speeding Up PCRE2 With SLJIT</h1></header>
<p><a href="https://www.pcre.org/" target="_blank" rel="noopener noreferrer">PCRE2</a> is a C library for matching regular expressions.
This library translates patterns into byte code, and this byte code can be executed by its interpreter.
The library also has a just-in-time (JIT) compiler which can produce machine code from the byte code to further improve the matching performance.
Before going into the details of the JIT compiler, the reason of choosing byte code as an internal representation is explained first.</p>
<p>Regular expressions were originally designed for defining a set of words using special patterns, and engines only needed to decide whether a given word is in the set.
Eventually patterns become a list of commands, and pattern matching engines become script languages.
Today many constructs of structured programming are available in regular expressions (pcre2pattern / perlre) such as loops (called repetitions), if-else selection (called conditional blocks), function calls (called recursions), returns and breaks (called control verbs).
The execution of each command is accurately defined which allows fine control over the entire matching process.
Patterns can also store information in local variables (called capturing blocks and marks) and these variables are often available after the matching is completed.
Byte code is used as an internal representation in many script languages, and modern regular expression engines are no different.
There are several methods to improve the performance of byte code execution (including JIT compiling), but even the fastest script language can do very little to improve the speed of a slow bubble sort.
Hence it is recommended to carefully design patterns to avoid slow matching speed.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="structure-of-the-generated-code">Structure of the Generated Code<a href="#structure-of-the-generated-code" class="hash-link" aria-label="Direct link to Structure of the Generated Code" title="Direct link to Structure of the Generated Code">​</a></h2>
<p>Regular expression patterns are a sequence of sub-patterns which are matched in concatenation order.
When a sub-pattern matches successfully, the engine tries to match the next sub-pattern, and when its matching is failed, the engine falls back to the previous sub-pattern.
If the previous sub-pattern has multiple options for matching, and another option does match, the engine will try to match the next sub-pattern again.
This technique is called backtracking.</p>
<p>The code generated by PCRE2 JIT is specialized for this execution order.
For each sub-pattern the compiler generates two code paths called matching and backtracking path.
The order of matching paths in the generated code is the same as the original concatenation order since the next sub-pattern must be matched after a successful match.
However the backtracking paths are generated in a reversed concatenation order because the engine must fall back to the previous sub-pattern after a failed match.
Control flow is shown in the next figure where green and red arrows show the possible control transfers from matching and backtracking paths respectively.
Due to the code generation order described before, no jump instructions are needed for control transfers represented by horizontal arrows.</p>
<p><img decoding="async" loading="lazy" alt="figure1" src="/sljit/assets/images/figure1-f7e963db6a1912b8477ee35590768009.svg" width="718" height="163" class="img_ev3q"></p>
<p>The next figure shows the structure of the machine code generated from the /a(?:\w\d)+d/ pattern:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># Start of matching paths</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ENTER</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># Matching path of matching the &quot;a&quot; letter</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   MATCH </span><span class="token string" style="color:#e3116c">&quot;a&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> IF FAILS GOTO L6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># Matching path of (?:)+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   STACK_PUSH NULL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">L1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># Matching path of matching the \w special character</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   MATCH WORD_CHARACTER</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> IF FAILS GOTO L5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># Matching path of matching the \d special character</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   MATCH DIGIT_CHARACTER</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> IF FAILS GOTO L4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># Continue the matching path of (?:)+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   STACK_PUSH STRING_POINTER</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   GOTO L1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">L2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># Matching path of matching the &quot;d&quot; letter</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   MATCH </span><span class="token string" style="color:#e3116c">&quot;d&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> IF FAILS GOTO L3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   RETURN SUCCESS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># Start of backtracking paths</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># Backtracking path of matching the &quot;d&quot; letter (empty)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">L3</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># Backtracking path of (?:)+ (empty)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># Backtracking path of matching the dot special character (empty)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">L4</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># Backtracking path of matching the &quot;b&quot; letter (empty)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">L5</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># Continue backtracking path of (?:)+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   STRING_POINTER </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> STACK_POP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   IF STRING_POINTER </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> NULL GOTO L2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># Backtracking path of matching the &quot;a&quot; letter (empty)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">L6</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   RETURN FAIL</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When a matching path has only one alternative (e.g. matching the letter <code>a</code>), the backtracking path is often empty, i.e. no instructions are generated at all.
Some constructs may contain the code paths of other sub-patterns.
In our example above, the code paths of <code>\w\d</code> sub-pattern is nested into the code paths of <code>(?:)+</code>.
Furthermore the current position in the input is stored in the <code>STRING_POINTER</code> variable.
This variable must have the correct value when the execution enters into a matching path, but it is undefined for backtracking paths.
Hence the backtracking path must restore (or set) it before jumps to a matching path.
This restoration can be seen in the backtracking path of <code>(?:)+</code>.</p>
<p>More about this method can be found in this <a href="https://dl.acm.org/doi/abs/10.1145/2544137.2544146" target="_blank" rel="noopener noreferrer">research paper</a>.
In the followings some optimizations done by the compiler is shown.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="single-character-repitition-optimizations">Single Character Repitition Optimizations<a href="#single-character-repitition-optimizations" class="hash-link" aria-label="Direct link to Single Character Repitition Optimizations" title="Direct link to Single Character Repitition Optimizations">​</a></h2>
<p>Sometimes multiple letters represent a single character, such as <code>sh</code> in English or <code>sch</code> in German.
These sequences cannot be broken into smaller parts, so perl calls them atomic blocks.
Another well known example is <code>\r\n</code> which represents a single newline.
Although <code>\r</code> and <code>\n</code> are also newlines, the <code>x\R{2}y</code> pattern does not match to <code>x\r\ny</code>, because there is only one newline between <code>x</code> and <code>y</code> letters.
Atomic blocks can speed up matching, since they can eliminate many retries.
For example <code>a+b</code> and <code>a++b</code> matches to the same strings since no <code>b</code> can be present in a sequence of <code>a</code>-s.
Hence the engine automatically converts the repetitions to the latter form whenever it has no side effects.</p>
<p>The JIT compiler can speed up repetitions followed by a single character as well.
An example is <code>\w+x</code>, where <code>\w+</code> cannot be converted to <code>\w++</code> because <code>x</code> is included in <code>\w</code> character class.
The code generated for <code>\w+</code> also records the first and last occurrence of <code>x</code> and backtracking is limited to this range.
This optimization has the highest efficiency when at most one <code>x</code> is found during the repetition.</p>
<p>The <code>(*SKIP)</code> control verb allows moving forward in the input.
For example, this verb can be used to search identifiers in a source code excluding comments and string literals.
To do that, the pattern should also look for comments and string literals but it skips these blocks instead of returning with a match.
Skip can be used to improve performance as well.
The <code>\w+!</code> and <code>\w+(*SKIP)!</code> patterns match to the same strings because when <code>\w+</code> is matched to a range of characters, but the match is failed afterwards, then any other match attempts within this range must fail as well.
Therefore the search can be resumed from the end of the range which eliminates several match attempts.
Besides adding <code>(*SKIP)</code> verbs to the pattern, the JIT compiler can also enhance iterators to remember the range of their last successful match, and any future matching attempts within this range triggers a fail.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="character-class-optimizations">Character Class Optimizations<a href="#character-class-optimizations" class="hash-link" aria-label="Direct link to Character Class Optimizations" title="Direct link to Character Class Optimizations">​</a></h2>
<p>Checking that a character is in a set of characters (called character classes) is a frequent operation in pattern matching.
When caseless mode is enabled, even a simple pattern character may match to different characters especially when UTF is enabled.</p>
<p>The most basic optimization is caseless compare with a single compare instruction if there is only one bit difference between the binary representation of the lower and upper case of a character.
For example, ascii <code>x</code> and <code>X</code> differs only in bit 6, so <code>(chr|0x20)==&#x27;x&#x27;</code> performs a caseless compare, and it is faster than doing two compares.
This can be extended to ranges, so the <code>[f-xF-X]</code> range can be checked with this formula: <code>((chr|0x20)-&#x27;f&#x27;)&lt;(&#x27;x&#x27;-&#x27;f&#x27;)</code>.
Optimizing these cases is no different from optimizing conditional expressions in static compilers such as GCC.</p>
<p>The JIT compiler also has some UTF related optimizations.
For example, if a class is limited to characters less than 128 in UTF8 mode, reading only the next byte is enough and it is faster than decoding the UTF8 character.
This optimization is not limited to the previous case, the compiler can generate specialized readers which do not decode characters outside of a given range.
When invalid UTF8 parsing is enabled, the character reader first checks whether the input buffer has at least four remaining bytes.
This is nearly always true, and then the character can be decoded without further boundary checks since four is the size of the longest UTF8 character.</p>
<p>The JIT compiler generates helper functions for several operations, such as decoding complex UTF cases.
These functions are extremely lightweight: they don&#x27;t set up a call frame or save any CPU registers, and can even modify the status of the caller.
The effect is quite similar to inlining, except that the function is actually called.
Must CPUs has return address predictors, so calling these functions are cheap operations.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="literal-optimizations">Literal Optimizations<a href="#literal-optimizations" class="hash-link" aria-label="Direct link to Literal Optimizations" title="Direct link to Literal Optimizations">​</a></h2>
<p>Literals are fixed character sequences and they are often found in patterns.
Comparing them to the input is a frequent task which normally requires the same number of steps as the length of the literal.
However CPU registers are often large enough to hold multiple characters so the number of comparisons can be reduced as long as the CPU can read a whole register from any starting address.
Such read is called unaligned access and requires hardware support.</p>
<p>Single Instruction Multiple Data (SIMD) operations can speed up literal searching.
These operations can process the input efficiently since they use large registers which can hold several input characters.
The JIT compiler uses SIMD for searching characters and character pairs.
Searching a pair is based on an observation that the chance of finding a pair is often much lower than finding a single character.
The only condition is that the two characters of a pair must be different since searching two spaces instead of one might not give better results.
The compiler tries to detect the pair with the lowest match probability, so it will choose the <code>a</code> and <code>c</code> characters from the <code>a.(?i:b).c</code> pattern.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h2>
<p>PCRE2 is among the most feature rich regular expression libraries.
It supports many regular expression constructs and it has many operating modes.
Its JIT compiler tries to optimize many of these features with static compiler optimizations, and this text introduces some of these optimizations.
Besides these optimizations, directed pattern transformations can also help to improve performance, but that is the focus of other projects such as <a href="https://github.com/zherczeg/repan" target="_blank" rel="noopener noreferrer">repan</a>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/zherczeg/sljit/docs/docs/../general/use-cases/pattern-matching/speeding-up-pcre2-with-sljit.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/sljit/docs/category/pattern-matching"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Pattern Matching</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/sljit/docs/general/use-cases/pattern-matching/regular-expression-engine-types"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Regular Expression Engine Types</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#structure-of-the-generated-code" class="table-of-contents__link toc-highlight">Structure of the Generated Code</a></li><li><a href="#single-character-repitition-optimizations" class="table-of-contents__link toc-highlight">Single Character Repitition Optimizations</a></li><li><a href="#character-class-optimizations" class="table-of-contents__link toc-highlight">Character Class Optimizations</a></li><li><a href="#literal-optimizations" class="table-of-contents__link toc-highlight">Literal Optimizations</a></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Content</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/sljit/docs/general/introduction">Docs</a></li><li class="footer__item"><a class="footer__link-item" href="/sljit/docs/tutorial/overview">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/zherczeg/sljit" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Attribution</div><ul class="footer__items clean-list"><li class="footer__item">
                  <span>
                    <a href="https://www.figma.com/community/file/1166831539721848736/solar-icons-set">
                      Solar Icon Set
                    </a>
                    by
                    <a href="https://www.figma.com/@480design">
                      480 Design
                    </a>
                    and
                    <a href="https://www.figma.com/@voidrainbow">
                      R4IN80W
                    </a>
                    |
                    <a href="http://creativecommons.org/licenses/by/4.0/">
                      CC BY 4.0
                    </a>
                  </span>
                </li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 SLJIT contributors. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>